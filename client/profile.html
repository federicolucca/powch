<!DOCTYPE html>
<html>
	<head>
		<title>PoWch</title>
        
        <link rel="stylesheet" type="text/css" href="lib/bootstrap/css/bootstrap.min.css"/>
        <link rel="stylesheet" type="text/css" href="css/powch.css"/>
        <link rel="stylesheet" type="text/css" href="css/profile.css"/>
        
        <script type="text/javascript" src="lib/jquery.min.js"></script>
        <script type="text/javascript" src="lib/bootstrap/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="lib/chart.min.js"></script>
        <script type="text/javascript" src="js/jolie-client.js"></script>
        <script>
            
            var token,
                currentContract,
                suggestionData,
                consumptionData;
            
            window.onload = function() {
                var request;
                token = sessionStorage.token;
                currentContract = sessionStorage.contract;
                $("#username").html(sessionStorage.username);
                
                console.log("Token: " + sessionStorage.token);
                request = {token: sessionStorage.token};
                JolieClient.getPointCount(request, onGotPoints, onError);
                JolieClient.getContracts(request, onGotContracts, onError);
                // displayContract({label: "Apartment"});
            };
            
            function displayContract(contract) {
                var contractButton = $("#hidden-contract").clone();
                $(contractButton).click(function() {
                              sessionStorage.contractId = contract.id;
                              if (contract.users.length > 0) {
                              sessionStorage.contractUsers = JSON.stringify(contract.users);
                              } else {
                              sessionStorage.contractUsers = contract.users[0];
                              }
                              window.location.href = "contract.html";
                              });
                contractButton.html(contract.label);
                contractButton.css("display", "inline-block");
                $("#contracts-div").append(contractButton);
            }
            
            // Callback functions
            function onGotContracts(response) {
                var contracts = response.contracts;
                for (var i = 0; i < contracts.length; i++) {
                    displayContract(contracts[i]);
                }
            }
            
            function onGotPoints(response) {
                $("#point-count").html("x " + response.count);
            }
            
            function onError(error) {
                console.log(error);
            }
            
            </script>
    </head>
	<body>
        <div id="contents">
            <div id="nav-top" class="navbar navbar-fixed-top center">
                <div class="navbar-inner">
                    <a class="brand">PoWch</a>
                </div>
            </div>
            <!--div id="contracts-div">
                <div class="btn-group">
                    <a class="btn btn-large dropdown-toggle" data-toggle="dropdown" href="#">
                        Contracts
                        <span class="caret"></span>
                    </a>
                    <ul id="contract-dropdown" class="dropdown-menu">
                    </ul>
                </div>
            </div-->
            
            <div id="user-info">
                <div id="profile">
                    <img id="profile-img" src="img/default-profile.png"></img>
                    <h4 id="username"></h4>
                    <div id="points-div">
                        <img id="powch" src="img/powch-mini.png"></img>
                        <h4 id="point-count">x 0000</h4>
                    </div>
                </div>
            </div>
            
            <div id="contracts-div" class="side-div">
                <button id="hidden-contract" class="btn btn-large proto-contract" type="button">
                    House
                </button>
            </div>
            
            <div id="misc-div" class="side-div">
                <button class="btn btn-large" type="button">
                    Challenges
                </button>
                
                <button class="btn btn-large" type="button">
                    Advice
                </button>
                
                <button class="btn btn-large" type="button">
                    Store
                </button>
                
                <button class="btn btn-large" type="button">
                    Invoices
                </button>
            </div>
            
            <div class="navbar navbar-fixed-bottom">
                <div class="navbar-inner">
                </div>
            </div>
        </div>
    </body>
</html>

