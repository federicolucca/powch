<!DOCTYPE html>
<html>
	<head>
		<title>PoWch</title>
        
        <link rel="stylesheet" type="text/css" href="lib/bootstrap/css/bootstrap.min.css"/>
        <link rel="stylesheet" type="text/css" href="css/powch.css"/>
        <link rel="stylesheet" type="text/css" href="css/profile.css"/>
        
        <script type="text/javascript" src="lib/jquery.min.js"></script>
        <script type="text/javascript" src="lib/bootstrap/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="lib/chart.min.js"></script>
        <script type="text/javascript" src="js/jolie-client.js"></script>
        <script>
            
            var token,
                currentContract,
                suggestionData,
                consumptionData;
            
            window.onload = function() {
                var request;
                token = sessionStorage.token;
                currentContract = sessionStorage.contract;
                $("#username").html(sessionStorage.username);
                
                request = {token: sessionStorage.token};
                //JolieClient.getPointCount(request, onGotPoints, onError);
                //JolieClient.getContracts(request, onGotContracts, onError);
                displayContract({label: "Apartment"});
            };
            
            function displayContract(contract) {
                //id, label, users
                var listItem, link;
                listItem = document.createElement("li");
                link = document.createElement("a");
                $(link).html(contract.label);
                $(link).click(function() {
                              sessionStorage.contractId = contract.id;
                              sessionStorage.contractUsers = contract.users;
                              window.location.href = "contract.html";
                              });
                $(listItem).append(link);
                $("#contract-dropdown").append(listItem);
            }
            
            // Callback functions
            function onGotContracts(response) {
                var contracts = response.contracts;
                for (var i = 0; i < contracts.length; i++) {
                    displayContract(contracts[i]);
                }
            }
            
            function onGotPoints(response) {
                $("#point-count").html("x " + response.points);
            }
            
            function onError(error) {
                console.log(error);
            }
            
            </script>
    </head>
	<body>
        <div id="contents">
            <div id="nav-top" class="navbar navbar-fixed-top center">
                <div class="navbar-inner">
                    <a class="brand">PoWch</a>
                </div>
            </div>
            <div id="contracts-div">
                <div class="btn-group">
                    <a class="btn btn-large dropdown-toggle" data-toggle="dropdown" href="#">
                        Contracts
                        <span class="caret"></span>
                    </a>
                    <ul id="contract-dropdown" class="dropdown-menu">
                    </ul>
                </div>
            </div>
            
            <div id="user-info">
                <div id="profile">
                    <img id="profile-img" src="../img/default-profile.png"></img>
                    <div id="points-div">
                        <img id="powch" src="../img/powch-mini.png"></img>
                        <h4 id="point-count">x 0000</h4>
                    </div>
                    <p id="username"></p>
                </div>
                
            </div>
            
            <div class="navbar navbar-fixed-bottom">
                <div class="navbar-inner">
                </div>
            </div>
        </div>
    </body>
</html>

